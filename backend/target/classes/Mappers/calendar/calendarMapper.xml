<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    

<mapper namespace="com.pj.planbee.mapper.CalendarMapper"> <!-- ì—¬ê¸°ê°€ ì‚¬ìš©í•  ë§¤í¼ë¥¼ ì—°ê²°í•´ì£¼ëŠ” ì—­í• , ê²½ë¡œì£¼ì˜ -->
	<resultMap type="com.pj.planbee.dto.CalendarDTO" id="calDTO"> <!-- databaseì˜ í‘œ -->
		<id property="calId" column="cal_id" /> <!-- PKë¡œ ì§€ì •í•œ ê²ƒì€ idë¡œ ë°›ì•„ì¤€ë‹¤ -->
		<result property="calDetail1" column="cal_detail_1" />
		<result property="calDetail2" column="cal_detail_2" />
		<result property="calDetail3" column="cal_detail_3"/>
		<result property="calDate" column="cal_date" />
		<result property="userId" column="user_id" />
		<result property="calProgress" column="cal_progress" />
	
	<!-- íŠ¹ì • ë‚ ì§œ ë©”ëª¨ ì¡°íšŒ -->	
	</resultMap>
	<select id="getMemo" resultMap="calDTO">
    SELECT cal_id, cal_date, user_id, 
           COALESCE(cal_detail_1, '') AS cal_detail_1, 
           COALESCE(cal_detail_2, '') AS cal_detail_2, 
           COALESCE(cal_detail_3, '') AS cal_detail_3, 
           cal_progress
    FROM Calendar 
    WHERE cal_date = #{calDate} AND user_id = #{sessionId}
</select>


    <!-- íŠ¹ì • ì›”ì˜ ë°ì´í„° ê°œìˆ˜ í™•ì¸ -->
    <select id="countByMonth" resultType="int">
        SELECT COUNT(*) FROM Calendar
        WHERE cal_date LIKE #{monthPre} || '%' AND user_id = #{userId}
    </select>

    <!-- ì—¬ëŸ¬ ë‚ ì§œ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì‚½ìž… (Insert) -->
    <insert id="insertNewDate">
        INSERT INTO Calendar (cal_date, user_id, cal_detail_1, cal_detail_2, cal_detail_3, cal_progress)
        VALUES
        <foreach collection="date" item="item" separator=",">
            (#{item.calDate}, #{item.userId}, #{item.calDetail1}, #{item.calDetail2}, #{item.calDetail3}, #{item.calProgress})
        </foreach>
    </insert>

    <!-- íŠ¹ì • ì—°ë„/ì›”ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒ -->
    <select id="getByMonth" resultMap="calDTO">
        SELECT * FROM Calendar
        WHERE cal_date LIKE #{monthPre} || '%' AND user_id = #{userId}
        ORDER BY cal_date
    </select>

    <!-- ðŸŸ¢ ë©”ëª¨ ì¶”ê°€ (INSERT) -->
	<insert id="addMemo" parameterType="com.pj.planbee.dto.CalendarDTO">
    	INSERT INTO Calendar (cal_date, user_id, cal_detail_1, cal_detail_2, cal_detail_3, cal_progress)
    	VALUES (#{calDate}, #{userId}, #{calDetail1}, #{calDetail2}, #{calDetail3}, #{calProgress});
	</insert>

	<!-- ðŸ”µ ê¸°ì¡´ ë©”ëª¨ ìˆ˜ì • (UPDATE) -->
	<update id="updateMemo" parameterType="com.pj.planbee.dto.CalendarDTO">
    	UPDATE Calendar
    	SET cal_detail_1 = #{calDetail1}, 
        	cal_detail_2 = #{calDetail2}, 
        	cal_detail_3 = #{calDetail3}, 
        	cal_progress = #{calProgress}
    	WHERE cal_date = #{calDate} AND user_id = #{userId};
	</update>
</mapper>